/**
 * videojs-chromecast
 * @version 0.0.0
 * @copyright 2016 Rick Sanchez <ricksancho@users.noreply.github.com>
 * @license MIT
 */
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.videojsChromecast=e()}}(function(){return function e(t,i,n){function a(r,o){if(!i[r]){if(!t[r]){var c="function"==typeof require&&require;if(!o&&c)return c(r,!0);if(s)return s(r,!0);var u=new Error("Cannot find module '"+r+"'");throw u.code="MODULE_NOT_FOUND",u}var l=i[r]={exports:{}};t[r][0].call(l.exports,function(e){var i=t[r][1][e];return a(i?i:e)},l,l.exports,e,t,i,n)}return i[r].exports}for(var s="function"==typeof require&&require,r=0;r<n.length;r++)a(n[r]);return a}({1:[function(e,t,i){(function(e){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=function(e,t,i){for(var n=!0;n;){var a=e,s=t,r=i;n=!1,null===a&&(a=Function.prototype);var o=Object.getOwnPropertyDescriptor(a,s);if(void 0!==o){if("value"in o)return o.value;var c=o.get;if(void 0===c)return;return c.call(r)}var u=Object.getPrototypeOf(a);if(null===u)return;e=u,t=s,i=r,n=!0,o=u=void 0}},c="undefined"!=typeof window?window.videojs:"undefined"!=typeof e?e.videojs:null,u=n(c),l=u["default"].getComponent("Button"),d=function(e){function t(e,i){a(this,t),o(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e,i),this.chromecast=e.getChild("ChromecastPlayer"),this.on(this.chromecast,"castAvailable",this.show),this.on(this.chromecast,"castUnavailable",this.hide),this.on(this.chromecast,"castConnected",this.handleConnected),this.on(this.chromecast,"castDisconnected",this.handleDisconnected),this.chromecast.apiInitialized||this.hide()}return s(t,e),r(t,[{key:"buildCSSClass",value:function(){return"vjs-chromecast-button "+o(Object.getPrototypeOf(t.prototype),"buildCSSClass",this).call(this)}},{key:"handleClick",value:function(){this.chromecast.trigger("toggle")}},{key:"handleConnected",value:function(){this.addClass("connected")}},{key:"handleDisconnected",value:function(){this.removeClass("connected")}}]),t}(l);d.prototype.controlText_="Chromecast",u["default"].registerComponent("ChromecastButton",d),i["default"]=d,t.exports=i["default"]}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,i){(function(e){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=function(e,t,i){for(var n=!0;n;){var a=e,s=t,r=i;n=!1,null===a&&(a=Function.prototype);var o=Object.getOwnPropertyDescriptor(a,s);if(void 0!==o){if("value"in o)return o.value;var c=o.get;if(void 0===c)return;return c.call(r)}var u=Object.getPrototypeOf(a);if(null===u)return;e=u,t=s,i=r,n=!0,o=u=void 0}},c="undefined"!=typeof window?window.videojs:"undefined"!=typeof e?e.videojs:null,u=n(c),l=u["default"].getComponent("Component"),d=function(e){function t(e,i){a(this,t),o(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e,i),this.on("stopCast",this.handleStopCast),this.on("startCast",this.handleStartCast),this.on("toggle",this.handleToggle),this.on("castAvailable",this.handleCastAvailable),this.on("castUnavailable",this.handleCastUnavailable),this.on("castConnected",this.handleCastConnected),this.on("castDisconnected",this.handleCastDisconnected),this.baseUrl=location.origin,this.casting=!1,this.apiInitialized=!1,this.inactivityTimeout=2e3,this.apiSession=null,this.apiConfig=null,this.player_.options_.chromecasttech={chromecast:this},this.initializeApi()}return s(t,e),r(t,[{key:"handleToggle",value:function(){this.casting?this.trigger("stopCast"):this.trigger("startCast")}},{key:"handleCastConnected",value:function(){u["default"].log("handleCastConnected"),this.player_.textTrackDisplay.hide()}},{key:"handleCastDisconnected",value:function(){u["default"].log("handleCastDisconnected"),this.player_.textTrackDisplay.show()}},{key:"handleCastAvailable",value:function(){u["default"].log("handleCastAvailable")}},{key:"handleCastUnavailable",value:function(){u["default"].log("handleCastUnavailable")}},{key:"handleStopCast",value:function(){u["default"].log("onStopCast"),this.stopCasting()}},{key:"handleStartCast",value:function(){u["default"].log("onStartCast"),this.apiInitialized?this.apiSession?this.onSessionSuccess(this.apiSession):chrome.cast.requestSession(this.onSessionSuccess.bind(this),this.castError):u["default"].log("Session not initialized")}},{key:"initializeApi",value:function(){var e=void 0;if(u["default"].browser.IS_CHROME){if(!chrome.cast||!chrome.cast.isAvailable)return u["default"].log("Cast APIs not available. Retrying..."),void setTimeout(this.initializeApi.bind(this),1e3);u["default"].log("Cast APIs are available");var t=chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID;e=new chrome.cast.SessionRequest(t),this.apiConfig=new chrome.cast.ApiConfig(e,this.sessionJoinedListener.bind(this),this.receiverListener.bind(this)),chrome.cast.initialize(this.apiConfig,this.onInitSuccess.bind(this),this.castError.bind(this))}}},{key:"sessionJoinedListener",value:function(e){u["default"].log("Session joined: "+e.sessionId),this.apiSession=e}},{key:"receiverListener",value:function(e){"available"===e&&this.trigger("castAvailable")}},{key:"onInitSuccess",value:function(){this.apiInitialized=!0}},{key:"castError",value:function(e){u["default"].log("Cast Error: "+JSON.stringify(e))}},{key:"onSessionSuccess",value:function(e){u["default"].log("Session initialized: "+e.sessionId),this.apiSession=e,this.trigger("castConnected");var t=new chrome.cast.media.MediaInfo(this.player_.currentSrc(),this.player_.currentType());t.metadata=new chrome.cast.media.GenericMediaMetadata;var i=1,n=[],a=[],s=!0,r=!1,o=void 0;try{for(var c,l=this.player_.textTracks().tracks_[Symbol.iterator]();!(s=(c=l.next()).done);s=!0){var d=c.value;u["default"].log(i+" "+d.language+" "+d.label+" "+d.src+" "+d.type);var h=new chrome.cast.media.Track(i,chrome.cast.media.TrackType.TEXT);"/"===d.src[0]?h.trackContentId=this.baseUrl+"/"+d.src:h.trackContentId=d.src,h.trackContentType="text/vtt",h.subtype=chrome.cast.media.TextTrackType.SUBTITLES,h.name=d.label,h.language=d.language,h.customData=null,a.push(h),"showing"===h.mode&&n.push(i),i++}}catch(f){r=!0,o=f}finally{try{!s&&l["return"]&&l["return"]()}finally{if(r)throw o}}t.textTrackStyle=new chrome.cast.media.TextTrackStyle,t.tracks=a;var p=new chrome.cast.media.LoadRequest(t);p.autoplay=!0,p.currentTime=this.player_.currentTime(),p.activeTrackIds=n,this.apiSession.loadMedia(p,this.onMediaDiscovered.bind(this),this.castError),this.apiSession.addUpdateListener(this.onSessionUpdate.bind(this))}},{key:"onSessionUpdate",value:function(e){this.apiSession&&(e||this.onStopAppSuccess())}},{key:"onMediaDiscovered",value:function(e){this.apiMedia=e;var t=this.player_.textTracks().tracks_;this.player_.loadTech_("ChromecastTech",this.player_.currentSrc()),this.player_.textTracks().tracks_=t,this.casting=!0,this.inactivityTimeout=this.player_.options_.inactivityTimeout,this.player_.options_.inactivityTimeout=0,this.player_.userActive(!0)}},{key:"stopCasting",value:function(){this.apiSession.stop(this.onStopAppSuccess.bind(this),this.onError)}},{key:"onStopAppSuccess",value:function(){if(this.apiSession){var e=this.player_.currentSrc(),t=this.player_.currentTime(),i=this.player_.paused();this.player_.loadTech_("Html5"),this.player_.src({src:e}),i||this.player_.one("seeked",function(){this.player_.play()}),this.player_.currentTime(t),this.player_.tech_.setControls(!1),this.player_.options_.inactivityTimeout=this.inactivityTimeout,this.casting=!1,this.apiMedia=null,this.apiSession=null,this.trigger("castDisconnected")}}}]),t}(l);u["default"].registerComponent("ChromecastPlayer",d),i["default"]=d.js,t.exports=i["default"]}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],3:[function(e,t,i){(function(e){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=function(e,t,i){for(var n=!0;n;){var a=e,s=t,r=i;n=!1,null===a&&(a=Function.prototype);var o=Object.getOwnPropertyDescriptor(a,s);if(void 0!==o){if("value"in o)return o.value;var c=o.get;if(void 0===c)return;return c.call(r)}var u=Object.getPrototypeOf(a);if(null===u)return;e=u,t=s,i=r,n=!0,o=u=void 0}},c="undefined"!=typeof window?window.videojs:"undefined"!=typeof e?e.videojs:null,u=n(c),l=u["default"].getTech("Tech"),d=function(e){function t(e,i){a(this,t),o(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e,i),this.featuresVolumeControl=!0,this.movingMediaElementInDOM=!1,this.featuresFullscreenResize=!1,this.featuresProgressEvents=!0,this.source=e.source,this.chromecast=e.chromecast,this.apiMedia=e.chromecast.apiMedia,this._paused=!0,this._muted=!1,this.currentVolume=1,this.currentMediaTime=0,this.timer=null,this.timerStep=1e3,this.apiMedia.addUpdateListener(this.onMediaStatusUpdate.bind(this)),this.startProgressTimer(this.incrementMediaTime.bind(this)),this.textTracks().on("change",this.onTrackChangeHandler.bind(this)),this.triggerReady()}return s(t,e),r(t,[{key:"dispose",value:function(){this.timer&&clearInterval(this.timer),this.textTracks().removeEventListener("change",this.onTrackChangeHandler),o(Object.getPrototypeOf(t.prototype),"dispose",this).call(this)}},{key:"createEl",value:function(){var e=this.options().chromecast,t=e.apiSession.receiver.friendlyName,i=u["default"].createEl("div");return i.className="vjs-tech vjs-tech-chromecast",i.innerHTML="\n<div class='casting-image' style='background-image: url('')'></div>\n<div class='casting-overlay'>\n<div class='casting-information'>\n<div class='casting-icon'>&#58880</div>\n<div class='casting-description'><small>Casting to</small><br>"+t+"</div>\n</div>\n</div>",i}},{key:"play",value:function(){this.apiMedia&&this._paused&&(this.apiMedia.play(null,this.onPlaySuccess.bind(this),this.onError),this._paused=!1)}},{key:"onPlaySuccess",value:function(){this._pause=!1,this.trigger("play")}},{key:"paused",value:function(){return this._paused}},{key:"pause",value:function(){this.apiMedia&&(this._paused||this.apiMedia.pause(null,this.onPauseSuccess.bind(this),this.onError))}},{key:"onPauseSuccess",value:function(){this._paused=!0,this.trigger("pause")}},{key:"currentTime",value:function(){return this.currentMediaTime}},{key:"setCurrentTime",value:function(e){var t=new chrome.cast.media.SeekRequest;t.currentTime=e,this._paused||(t.resumeState=chrome.cast.media.ResumeState.PLAYBACK_START),this.apiMedia.seek(t,this.onSetCurrentTimeSuccess.bind(this,e),this.onError)}},{key:"onSetCurrentTimeSuccess",value:function(e){this.currentMediaTime=e,this.trigger("seekMedia")}},{key:"volume",value:function(){return this.currentVolume}},{key:"setVolume",value:function(e){return this.setMediaVolume(e,!1)}},{key:"muted",value:function(){return this._muted}},{key:"setMuted",value:function(){return this.setMediaVolume(this.volume(),!this.muted())}},{key:"setMediaVolume",value:function(e,t){if(this.apiMedia){var i=new chrome.cast.Volume,n=new chrome.cast.media.VolumeRequest;i.level=e,i.muted=t,n.volume=i,this.apiMedia.setVolume(n,this.onSetMediaVolumeSuccess.bind(this,i.level,t),this.onError)}}},{key:"onSetMediaVolumeSuccess",value:function(e,t){this.currentVolume=e,this._muted=t,this.trigger("volumechange")}},{key:"supportsFullScreen",value:function(){return!1}},{key:"duration",value:function(){return this.apiMedia?this.apiMedia.duration:0}},{key:"currentSrc",value:function(){return this.source}},{key:"src",value:function(e){return"undefined"==typeof e?this.source:void(e!==this.source&&(this.source=e))}},{key:"controls",value:function(){return null}},{key:"onMediaStatusUpdate",value:function(e){if(this.apiMedia)switch(this.currentMediaTime=this.apiMedia.currentTime,this.apiMedia.playerState){case chrome.cast.media.PlayerState.IDLE:this.currentMediaTime=0,this.trigger("timeupdate"),this.chromecast.onStopAppSuccess();break;case chrome.cast.media.PlayerState.PAUSED:this._paused&&(this._paused=!0,this.trigger("pause"));break;case chrome.cast.media.PlayerState.PLAYING:this._paused&&(this._paused=!1,this.trigger("play"))}}},{key:"incrementMediaTime",value:function(){this.apiMedia.playerState===chrome.cast.media.PlayerState.PLAYING&&(this.currentMediaTime<this.apiMedia.media.duration?(this.currentMediaTime+=1,this.trigger("timeupdate")):(this.currentMediaTime=0,clearInterval(this.timer)))}},{key:"startProgressTimer",value:function(e){this.timer&&(clearInterval(this.timer),this.timer=null),this.timer=setInterval(e.bind(this),this.timerStep)}},{key:"mediaCommandSuccessCallback",value:function(e,t){u["default"].log(e)}},{key:"onTrackChangeHandler",value:function(){var e=1,t=[],i=!0,n=!1,a=void 0;try{for(var s,r=this.textTracks().tracks_[Symbol.iterator]();!(i=(s=r.next()).done);i=!0){var o=s.value;"showing"===o.mode&&t.push(e),e++}}catch(c){n=!0,a=c}finally{try{!i&&r["return"]&&r["return"]()}finally{if(n)throw a}}if(this.apiMedia){var u=new chrome.cast.media.EditTracksInfoRequest(t);this.apiMedia.editTracksInfo(u,this.onTrackSuccess.bind(this),this.onTrackError.bind(this))}}},{key:"onTrackSuccess",value:function(){u["default"].log("onTrackSuccess")}},{key:"onTrackError",value:function(){u["default"].log("onTrackError")}},{key:"onError",value:function(){u["default"].log("chromecast error")}}]),t}(l);d.isSupported=function(){return this.apiInitialized},d.canPlaySource=function(e){return"video/mp4"===e.type||"video/webm"===e.type||"application/x-mpegURL"===e.type||"application/vnd.apple.mpegURL"===e.type},u["default"].registerTech("ChromecastTech",d),i["default"]=d,t.exports=i["default"]}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],4:[function(e,t,i){(function(n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(i,"__esModule",{value:!0});var s="undefined"!=typeof window?window.videojs:"undefined"!=typeof n?n.videojs:null,r=a(s),o=e("./chromecast-player.js"),c=(a(o),e("./chromecast-button.js")),u=(a(c),e("./chromecast-tech.js")),l=(a(u),{}),d=function(e,t){var i=void 0;e.addClass("vjs-chromecast"),e.addChild("ChromecastPlayer"),i=e.controlBar.addChild("ChromecastButton",t),e.controlBar.el_.insertBefore(i.el(),e.controlBar.fullscreenToggle.el())},h=function(e){var t=this;this.ready(function(){d(t,r["default"].mergeOptions(l,e))})};r["default"].plugin("chromecast",h),h.VERSION="0.0.0",i["default"]=h,t.exports=i["default"]}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./chromecast-button.js":1,"./chromecast-player.js":2,"./chromecast-tech.js":3}]},{},[4])(4)});